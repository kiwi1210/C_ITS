<!DOCTYPE html>
<html>
<head>
    <title>Animated Vehicle Trajectory</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; overflow: hidden; } /* Added Inter font and overflow hidden */
        #map { height: 100vh; width: 100%; }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 300px;
            display: flex; /* Added flex for better layout */
            flex-direction: column; /* Stack controls vertically */
            gap: 10px; /* Spacing between control rows */
        }
        .controls h3 { margin: 0 0 5px 0; color: #333; }
        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
        }
        .control-row button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px; /* Slightly more rounded */
            background: #007cba;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease, transform 0.1s ease; /* Smooth transitions */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Subtle shadow */
        }
        .control-row button:hover {
            background: #005a87;
            transform: translateY(-1px); /* Slight lift on hover */
        }
        .control-row button:active {
            transform: translateY(1px); /* Press effect */
        }
        .control-row button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        #progressSlider {
            flex-grow: 1; /* Allow slider to take available width */
            margin-right: 10px;
            -webkit-appearance: none; /* Remove default styling for custom track */
            appearance: none;
            height: 8px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            border-radius: 4px;
        }
        #progressSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007cba;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        #progressSlider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007cba;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .info { font-size: 13px; color: #444; margin-top: 5px; background-color: #f0f0f0; padding: 8px; border-radius: 5px; } /* Improved info box */
        .legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 200px;
        }
        .legend h4 { margin: 0 0 10px 0; color: #333; }
        .legend-item { display: flex; align-items: center; margin: 8px 0; }
        .legend-color { width: 20px; height: 20px; border-radius: 50%; margin-right: 10px; border: 1px solid #ccc; /* Lighter border */ }
        
        /* Mobile responsiveness */
        @media (max-width: 600px) {
            .controls {
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: none;
            }
            .legend {
                right: 50%;
                transform: translateX(50%);
                top: auto;
                bottom: 10px;
                width: 90%;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="map"></div>
    
    <div class="controls">
        <h3>üöó Vehicle Trajectory Animation</h3>
        <div class="control-row">
            <button id="playBtn" onclick="toggleAnimation()">‚ñ∂Ô∏è Play</button>
            <button onclick="resetAnimation()">‚èπÔ∏è Reset</button>
            <button onclick="changeSpeed(-100)">‚è™ Slower</button>
            <button onclick="changeSpeed(100)">‚è© Faster</button>
        </div>
        <div class="control-row">
            <label style="white-space: nowrap;">Progress:</label>
            <input type="range" id="progressSlider" min="0" max="100" value="0" oninput="seekTo(this.value)">
        </div>
        <div id="info" class="info">
            Loading trajectory data...
        </div>
    </div>

    <div class="legend">
        <h4>Speed Legend</h4>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #d62728;"></div>
            <span>Fast (>80 km/h)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ff7f0e;"></div>
            <span>Medium (40-80 km/h)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #2ca02c;"></div>
            <span>Slow (<40 km/h)</span>
        </div>
        <p style="font-size: 11px; margin: 10px 0 0 0; color: #666;">
            Point size also indicates speed
        </p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script>
        // Trajectory data will be loaded from the GeoJSON file
        let trajectoryData = [];

        // Function to transform raw GeoJSON data into the desired format
        // This now extracts speed directly from GeoJSON properties
        function processTrajectoryData(rawData) {
            const processedData = [];
            const features = rawData.features;

            if (features.length === 0) {
                return processedData;
            }

            for (let i = 0; i < features.length; i++) {
                const currentFeature = features[i];
                processedData.push({
                    lat: currentFeature.geometry.coordinates[1],
                    lng: currentFeature.geometry.coordinates[0],
                    // Use the speed directly from the GeoJSON properties
                    speed: currentFeature.properties.speed !== undefined ? currentFeature.properties.speed : 0, 
                    time: new Date(currentFeature.properties.time).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false })
                });
            }
            return processedData;
        }

        // --- Data Loading and Initialization ---
        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('info').innerHTML = 'Fetching trajectory data...';
            try {
                // Fetch the GeoJSON data from the specified file
                const rawTrajectoryData =  {
                    "type": "FeatureCollection",
                    "features": [
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0666066,
                                    47.8143653
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:40:46.890000+00:00",
                                "speed": 294.84000000000003,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0666242,
                                    47.8142929
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:40:47.883000+00:00",
                                "speed": 291.6,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0666339,
                                    47.8142572
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:40:48.383000+00:00",
                                "speed": 291.24,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0666422,
                                    47.8142286
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:40:48.890000+00:00",
                                "speed": 290.15999999999997,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0666759,
                                    47.8140988
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:40:50.591000+00:00",
                                "speed": 292.32,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0669673,
                                    47.8134471
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:40:59.481000+00:00",
                                "speed": 286.2,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0669919,
                                    47.8134084
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:00.083000+00:00",
                                "speed": 276.48,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0670335,
                                    47.813342
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:01.286000+00:00",
                                "speed": 257.76,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0670596,
                                    47.8133024
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:01.887000+00:00",
                                "speed": 241.20000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0670814,
                                    47.8132698
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:02.489000+00:00",
                                "speed": 234.0,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0671031,
                                    47.8132372
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:03.084000+00:00",
                                "speed": 237.95999999999998,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0671461,
                                    47.8131692
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:04.286000+00:00",
                                "speed": 254.52,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0671665,
                                    47.8131323
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:04.882000+00:00",
                                "speed": 252.35999999999999,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0671839,
                                    47.8130972
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:05.486000+00:00",
                                "speed": 239.04000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0671995,
                                    47.8130642
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:06.083000+00:00",
                                "speed": 228.96,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672228,
                                    47.8129969
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:07.383000+00:00",
                                "speed": 194.04,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672315,
                                    47.8129699
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:07.982000+00:00",
                                "speed": 174.6,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672416,
                                    47.8129459
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:08.582000+00:00",
                                "speed": 159.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672416,
                                    47.8129459
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:08.583000+00:00",
                                "speed": 159.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672532,
                                    47.8129244
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:09.185000+00:00",
                                "speed": 145.8,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672757,
                                    47.8128905
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:10.182000+00:00",
                                "speed": 150.12,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672954,
                                    47.8128589
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:11.187000+00:00",
                                "speed": 145.8,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0673032,
                                    47.8128412
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:11.784000+00:00",
                                "speed": 118.44,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.06731,
                                    47.8127923
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:15.597000+00:00",
                                "speed": 126.36000000000001,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0673014,
                                    47.8127739
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:16.094000+00:00",
                                "speed": 152.28,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672861,
                                    47.8127534
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:16.591000+00:00",
                                "speed": 177.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0672635,
                                    47.8127243
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:17.185000+00:00",
                                "speed": 232.20000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0663753,
                                    47.8117072
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:30.387000+00:00",
                                "speed": 270.72,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0663436,
                                    47.8116755
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:30.990000+00:00",
                                "speed": 257.40000000000003,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.066318,
                                    47.8116497
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:31.583000+00:00",
                                "speed": 244.07999999999998,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662893,
                                    47.8116207
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:32.185000+00:00",
                                "speed": 230.4,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662893,
                                    47.8116207
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:32.186000+00:00",
                                "speed": 230.4,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662644,
                                    47.8115953
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:32.782000+00:00",
                                "speed": 205.92000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662644,
                                    47.8115953
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:32.783000+00:00",
                                "speed": 205.92000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.066237,
                                    47.8115676
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:33.385000+00:00",
                                "speed": 174.6,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.066237,
                                    47.8115676
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:33.386000+00:00",
                                "speed": 174.6,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662211,
                                    47.8115513
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:41:33.883000+00:00",
                                "speed": 154.44,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0658428,
                                    47.8111351
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:42:38.582000+00:00",
                                "speed": 0.0,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0657603,
                                    47.8110568
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:43:45.182000+00:00",
                                "speed": 10.08,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0654843,
                                    47.8108072
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:45:16.581000+00:00",
                                "speed": 0.0,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0652341,
                                    47.8105809
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:46:35.782000+00:00",
                                "speed": 127.44,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0652052,
                                    47.8105546
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:46:36.786000+00:00",
                                "speed": 126.36000000000001,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0652052,
                                    47.8105546
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:46:36.787000+00:00",
                                "speed": 126.36000000000001,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0651718,
                                    47.8105251
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:46:37.789000+00:00",
                                "speed": 134.64,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0651411,
                                    47.8104979
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:46:38.783000+00:00",
                                "speed": 131.04,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0651103,
                                    47.810471
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:46:39.982000+00:00",
                                "speed": 100.08,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0647426,
                                    47.8101952
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:48:08.182000+00:00",
                                "speed": 52.56,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0645862,
                                    47.8100866
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:49:32.683000+00:00",
                                "speed": 47.16,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0643179,
                                    47.809815
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:00.083000+00:00",
                                "speed": 37.440000000000005,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0642509,
                                    47.809702
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:21.588000+00:00",
                                "speed": 134.28,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0642509,
                                    47.809702
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:21.592000+00:00",
                                "speed": 134.28,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.064251,
                                    47.8096834
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:22.084000+00:00",
                                "speed": 168.12,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0642547,
                                    47.8096572
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:22.688000+00:00",
                                "speed": 168.12,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0642547,
                                    47.8096572
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:22.689000+00:00",
                                "speed": 168.12,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0642619,
                                    47.8096356
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:23.282000+00:00",
                                "speed": 177.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0642854,
                                    47.8096048
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:23.881000+00:00",
                                "speed": 197.28,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0643096,
                                    47.8095837
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:24.392000+00:00",
                                "speed": 213.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0643471,
                                    47.8095595
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:24.982000+00:00",
                                "speed": 235.8,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0643961,
                                    47.8095321
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:25.687000+00:00",
                                "speed": 257.40000000000003,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0644328,
                                    47.8095118
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:26.191000+00:00",
                                "speed": 256.68,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0644622,
                                    47.8094953
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:26.687000+00:00",
                                "speed": 248.4,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0645077,
                                    47.8094688
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:27.282000+00:00",
                                "speed": 236.52,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0645457,
                                    47.8094461
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:27.887000+00:00",
                                "speed": 224.28,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0645806,
                                    47.8094251
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:28.486000+00:00",
                                "speed": 203.4,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0646124,
                                    47.8094063
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:29.082000+00:00",
                                "speed": 181.07999999999998,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0646608,
                                    47.8093764
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:30.290000+00:00",
                                "speed": 151.56,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0646836,
                                    47.8093623
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:30.786000+00:00",
                                "speed": 131.76000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0649202,
                                    47.8092357
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:46.383000+00:00",
                                "speed": 129.24,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0649418,
                                    47.8092226
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:46.883000+00:00",
                                "speed": 151.56,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0649738,
                                    47.8092045
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:47.484000+00:00",
                                "speed": 194.04,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0650528,
                                    47.8091602
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:48.684000+00:00",
                                "speed": 236.16,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0650966,
                                    47.8091342
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:49.383000+00:00",
                                "speed": 220.32000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.065137,
                                    47.8091099
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:50.083000+00:00",
                                "speed": 198.36,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0651729,
                                    47.8090884
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:50.784000+00:00",
                                "speed": 177.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0652013,
                                    47.8090709
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:51.483000+00:00",
                                "speed": 167.76000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0652341,
                                    47.8090507
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:52.185000+00:00",
                                "speed": 169.20000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0652693,
                                    47.8090297
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:52.884000+00:00",
                                "speed": 147.6,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0652976,
                                    47.8090126
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:53.586000+00:00",
                                "speed": 144.72000000000003,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0653268,
                                    47.8089949
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:54.282000+00:00",
                                "speed": 150.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0653637,
                                    47.8089724
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:55.283000+00:00",
                                "speed": 137.16,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0654005,
                                    47.8089499
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:56.282000+00:00",
                                "speed": 136.07999999999998,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0654395,
                                    47.8089251
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:51:57.184000+00:00",
                                "speed": 138.6,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0657692,
                                    47.8084412
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:47.884000+00:00",
                                "speed": 131.4,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0657767,
                                    47.8084071
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:48.884000+00:00",
                                "speed": 132.84,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0658015,
                                    47.8083122
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:51.888000+00:00",
                                "speed": 133.56,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0658101,
                                    47.8082831
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:52.690000+00:00",
                                "speed": 156.96,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.06582,
                                    47.8082533
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:53.388000+00:00",
                                "speed": 178.56,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0658324,
                                    47.8082214
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:54.087000+00:00",
                                "speed": 180.36,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0658409,
                                    47.8082018
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:54.583000+00:00",
                                "speed": 158.4,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0658687,
                                    47.8081488
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:56.389000+00:00",
                                "speed": 137.88,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.065886,
                                    47.8081211
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:56.984000+00:00",
                                "speed": 187.92000000000002,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0659128,
                                    47.8080816
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:57.783000+00:00",
                                "speed": 223.56,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0659396,
                                    47.8080467
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:58.388000+00:00",
                                "speed": 257.76,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0659906,
                                    47.8079864
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:59.383000+00:00",
                                "speed": 281.52000000000004,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0660193,
                                    47.8079552
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:52:59.883000+00:00",
                                "speed": 294.12,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0661731,
                                    47.8077932
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:53:02.384000+00:00",
                                "speed": 293.76,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662066,
                                    47.8077547
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:53:03.087000+00:00",
                                "speed": 226.44,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662397,
                                    47.8077134
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:53:04.184000+00:00",
                                "speed": 141.48,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662855,
                                    47.8076389
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:53:08.982000+00:00",
                                "speed": 153.36,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        },
                        {
                            "type": "Feature",
                            "geometry": {
                                "type": "Point",
                                "coordinates": [
                                    13.0662968,
                                    47.8076136
                                ]
                            },
                            "properties": {
                                "time": "2025-04-07T14:53:09.583000+00:00",
                                "speed": 181.07999999999998,
                                "icon": "circle",
                                "iconstyle": {
                                    "fillColor": "#e63946",
                                    "fillOpacity": 0.8,
                                    "stroke": "true",
                                    "radius": 5
                                }
                            }
                        }
                    ]
                }
                
                // Ensure Leaflet is loaded before processing data
                if (typeof L !== 'undefined') {
                    trajectoryData = processTrajectoryData(rawTrajectoryData);
                    if (trajectoryData.length > 0) {
                        initMapAndAnimation(); // Initialize map and animation after data is ready
                    } else {
                        document.getElementById('info').innerHTML = "No trajectory data found in the GeoJSON file.";
                    }
                } else {
                    console.error("Leaflet not loaded. Cannot process trajectory data.");
                    document.getElementById('info').innerHTML = "Error: Map library not loaded.";
                }
            } catch (error) {
                console.error("Error loading or processing GeoJSON data:", error);
                document.getElementById('info').innerHTML = `Failed to load trajectory data: ${error.message}. Please ensure 'salzburg_largest_trajectory.geojson' is accessible and valid.`;
            }
        });

        // --- Map Initialization ---
        let map;
        function initMapAndAnimation() {
            // Initialize map, centering on the first point of the trajectory
            map = L.map('map').setView([trajectoryData[0].lat, trajectoryData[0].lng], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬© OpenStreetMap contributors ¬© CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            // Add full trajectory path as a light gray dashed line
            const fullPath = trajectoryData.map(point => [point.lat, point.lng]);
            L.polyline(fullPath, {
                color: 'lightgray',
                weight: 3,
                opacity: 0.6,
                dashArray: '5, 5'
            }).addTo(map);

            // Initialize animation by showing the first marker
            updateMarker(0);
            
            // Adjust map view to fit the entire trajectory bounds
            const bounds = L.latLngBounds(trajectoryData.map(p => [p.lat, p.lng]));
            map.fitBounds(bounds, { padding: [20, 20] });

            document.getElementById('info').innerHTML = `Ready to start animation with ${trajectoryData.length} points.`;
        }

        // Animation variables
        let currentIndex = 0;
        let animationSpeed = 600; // milliseconds (set to 4x faster by default as requested)
        let isPlaying = false;
        let intervalId = null;
        let currentMarker = null;
        let trailMarkers = [];
        const maxTrailLength = 20;

        // Speed to color mapping function
        function speedToColor(speed) {
            if (speed >= 80) return '#d62728'; // Red - fast
            if (speed >= 40) return '#ff7f0e'; // Orange - medium
            return '#2ca02c'; // Green - slow
        }

        // Speed to radius mapping function (point size indicates speed)
        function speedToRadius(speed) {
            return Math.max(6, Math.min(16, speed * 0.15));
        }

        // Function to update the animated marker's position and details
        function updateMarker(index) {
            if (index < 0 || index >= trajectoryData.length) {
                console.error("Invalid index for updateMarker:", index);
                return;
            }

            const point = trajectoryData[index];
            
            // Remove the previous marker if it exists
            if (currentMarker) {
                map.removeLayer(currentMarker);
            }
            
            // Create a new circle marker for the current point
            currentMarker = L.circleMarker([point.lat, point.lng], {
                radius: speedToRadius(point.speed),
                fillColor: speedToColor(point.speed),
                color: '#000',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);
            
            // Bind and open a popup with detailed vehicle data
            currentMarker.bindPopup(`
                <b>üöó Vehicle Data</b><br>
                Speed: <b>${point.speed.toFixed(1)} km/h</b><br>
                Time: ${point.time}<br>
                Point: ${index + 1}/${trajectoryData.length}
            `).openPopup(); 
            
            // Update the trail of previous markers
            updateTrail(index);
            
            // Update the information display in the controls panel
            document.getElementById('info').innerHTML = `
                Point: ${index + 1}/${trajectoryData.length} | 
                Speed: <b>${point.speed.toFixed(1)} km/h</b> | 
                Time: ${point.time}
            `;
            
            // Update the progress slider's max and current value
            document.getElementById('progressSlider').max = trajectoryData.length - 1;
            document.getElementById('progressSlider').value = index;
            
            // Pan the map to keep the current marker in view
            map.panTo([point.lat, point.lng], { animate: true, duration: 0.5 });
        }

        // Function to update the trail of past markers
        function updateTrail(currentIdx) {
            // Remove all existing trail markers
            trailMarkers.forEach(marker => map.removeLayer(marker));
            trailMarkers = [];
            
            // Add new trail markers for a limited number of previous points
            const startIdx = Math.max(0, currentIdx - maxTrailLength);
            for (let i = startIdx; i < currentIdx; i++) {
                const point = trajectoryData[i];
                // Adjust opacity for a fading trail effect
                const opacity = 0.3 + (0.5 * (i - startIdx) / maxTrailLength);
                const radius = speedToRadius(point.speed) * 0.7; // Smaller radius for trail
                
                const trailMarker = L.circleMarker([point.lat, point.lng], {
                    radius: radius,
                    fillColor: speedToColor(point.speed),
                    color: speedToColor(point.speed),
                    weight: 1,
                    opacity: opacity,
                    fillOpacity: opacity * 0.7
                }).addTo(map);
                
                trailMarkers.push(trailMarker);
            }
        }

        // Function to toggle play/pause for the animation
        function toggleAnimation() {
            const playBtn = document.getElementById('playBtn');
            
            if (isPlaying) {
                clearInterval(intervalId); // Stop the animation
                isPlaying = false;
                playBtn.innerHTML = '‚ñ∂Ô∏è Play';
            } else {
                // Start/resume animation
                intervalId = setInterval(() => {
                    if (currentIndex < trajectoryData.length - 1) {
                        currentIndex++;
                        updateMarker(currentIndex);
                    } else {
                        // If at the end, loop back to the start
                        currentIndex = 0;
                        updateMarker(currentIndex);
                    }
                }, animationSpeed);
                isPlaying = true;
                playBtn.innerHTML = '‚è∏Ô∏è Pause';
            }
        }

        // Function to reset the animation to the beginning
        function resetAnimation() {
            clearInterval(intervalId); // Stop any ongoing animation
            isPlaying = false;
            currentIndex = 0; // Reset index to the start
            updateMarker(currentIndex); // Update marker to the starting position
            document.getElementById('playBtn').innerHTML = '‚ñ∂Ô∏è Play'; // Change button text
        }

        // Function to change the animation speed
        function changeSpeed(delta) {
            // Adjust speed, clamping it between 100ms and 2000ms
            animationSpeed = Math.max(100, Math.min(2000, animationSpeed - delta));
            if (isPlaying) {
                clearInterval(intervalId); // Clear existing interval
                toggleAnimation(); // Restart animation with new speed
            }
        }

        // Function to seek to a specific point in the trajectory using the slider
        function seekTo(index) {
            currentIndex = parseInt(index);
            updateMarker(currentIndex);
        }

    </script>
</body>
</html>